#!/usr/bin/bash
# =====================================================
# -----------------------------------------------------
# From: I cannot remember where I got this script from.
# Shows the current moon phase.
#     Modified by: Jason Bradberry (2024)
# -----------------------------------------------------
# =====================================================

# moonfile="${XDG_DATA_HOME:-$HOME/.local/share}/moonphase"
moonfile="${XDG_CACHE_HOME:-$HOME/.cache}/moonphase"

# [ -s "$moonfile" ] && [ "$(stat -c %y "$moonfile" 2>/dev/null | cut -d' ' -f1)" = "$(date '+%Y-%m-%d')" ] ||
{ curl -m 10 -sf "wttr.in/?format=%m" >"$moonfile" || exit 1; }

icon="$(cat "$moonfile")"

case "$icon" in
ğŸŒ‘) name="New" ;;
ğŸŒ’) name="Waxing Crescent" ;;
ğŸŒ“) name="First Quarter" ;;
ğŸŒ”) name="Waxing Gibbous" ;;
ğŸŒ•) name="Full" ;;
ğŸŒ–) name="Waning Gibbous" ;;
ğŸŒ—) name="Last Quarter" ;;
ğŸŒ˜) name="Waning Crescent" ;;
*) exit 1 ;;
esac

echo "| ${icon-?}"

case $BLOCK_BUTTON in
3) notify-send "ğŸŒœ Moon phase module" "Displays current moon phase.
- ğŸŒ‘: New
- ğŸŒ’: Waxing Crescent
- ğŸŒ“: First Quarter
- ğŸŒ”: Waxing Gibbous
- ğŸŒ•: Full
- ğŸŒ–: Waning Gibbous
- ğŸŒ—: Last Quarter
- ğŸŒ˜: Waning Crescent" ;;
6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac
